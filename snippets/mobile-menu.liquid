{%- comment -%}
  Mobile Menu Snippet - Oppozite Wears
  Full-screen mobile navigation
{%- endcomment -%}

<div class="mobile-menu" id="mobileMenu" data-mobile-menu aria-hidden="true">
  <div class="mobile-menu-inner">
    {%- comment -%} Close Button {%- endcomment -%}
    <button class="mobile-menu-close" data-mobile-menu-close aria-label="Close menu">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>

    {%- comment -%} Navigation Links {%- endcomment -%}
    <nav class="mobile-menu-nav" aria-label="Mobile navigation">
      {%- for link in linklists.main-menu.links -%}
        {%- if link.links.size > 0 -%}
          <div class="mobile-menu-item has-submenu">
            <button class="mobile-menu-link" data-submenu-toggle aria-expanded="false">
              {{ link.title }}
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="6 9 12 15 18 9"></polyline>
              </svg>
            </button>
            <div class="mobile-submenu">
              {%- for childlink in link.links -%}
                <a href="{{ childlink.url }}" class="mobile-submenu-link">
                  {{ childlink.title }}
                </a>
              {%- endfor -%}
            </div>
          </div>
        {%- else -%}
          <a href="{{ link.url }}" class="mobile-menu-link{% if link.active %} is-active{% endif %}">
            {{ link.title }}
          </a>
        {%- endif -%}
      {%- endfor -%}
    </nav>

    {%- comment -%} Account Links {%- endcomment -%}
    {%- if shop.customer_accounts_enabled -%}
      <div class="mobile-menu-account">
        {%- if customer -%}
          <a href="{{ routes.account_url }}" class="mobile-menu-account-link">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
            My Account
          </a>
          <a href="{{ routes.account_logout_url }}" class="mobile-menu-account-link">
            Log Out
          </a>
        {%- else -%}
          <a href="{{ routes.account_login_url }}" class="mobile-menu-account-link">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
            Sign In
          </a>
          <a href="{{ routes.account_register_url }}" class="mobile-menu-account-link">
            Create Account
          </a>
        {%- endif -%}
      </div>
    {%- endif -%}

    {%- comment -%} Social Links {%- endcomment -%}
    <div class="mobile-menu-social">
      {%- if settings.social_instagram != blank -%}
        <a href="{{ settings.social_instagram }}" target="_blank" rel="noopener" aria-label="Instagram">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <rect x="2" y="2" width="20" height="20" rx="5" ry="5"/>
            <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/>
            <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/>
          </svg>
        </a>
      {%- endif -%}
      {%- if settings.social_twitter != blank -%}
        <a href="{{ settings.social_twitter }}" target="_blank" rel="noopener" aria-label="Twitter">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
          </svg>
        </a>
      {%- endif -%}
      {%- if settings.social_tiktok != blank -%}
        <a href="{{ settings.social_tiktok }}" target="_blank" rel="noopener" aria-label="TikTok">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M9 12a4 4 0 1 0 4 4V4a5 5 0 0 0 5 5"/>
          </svg>
        </a>
      {%- endif -%}
    </div>
  </div>
</div>

<style>
  .mobile-menu {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: var(--z-modal);
    background: hsl(var(--foreground));
    color: hsl(var(--background));
    transform: translateX(-100%);
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }
  
  .mobile-menu.is-active {
    transform: translateX(0);
  }
  
  .mobile-menu-inner {
    min-height: 100%;
    padding: 6rem 2rem 4rem;
    display: flex;
    flex-direction: column;
  }
  
  .mobile-menu-close {
    position: absolute;
    top: 1.5rem;
    right: 1.5rem;
    background: none;
    border: none;
    color: hsl(var(--background));
    cursor: pointer;
    padding: 0.5rem;
  }
  
  .mobile-menu-nav {
    display: flex;
    flex-direction: column;
    gap: 0;
  }
  
  .mobile-menu-link {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    padding: 1rem 0;
    font-family: var(--font-display);
    font-size: 2rem;
    color: hsl(var(--background));
    text-decoration: none;
    background: none;
    border: none;
    border-bottom: 1px solid hsla(var(--background) / 0.2);
    cursor: pointer;
    text-align: left;
  }
  
  .mobile-menu-link.is-active {
    opacity: 0.7;
  }
  
  .mobile-submenu {
    display: none;
    padding: 0 0 1rem 1rem;
  }
  
  .mobile-menu-item.is-open .mobile-submenu {
    display: block;
  }
  
  .mobile-menu-item.is-open .mobile-menu-link svg {
    transform: rotate(180deg);
  }
  
  .mobile-submenu-link {
    display: block;
    padding: 0.75rem 0;
    font-size: 1rem;
    color: hsla(var(--background) / 0.7);
    text-decoration: none;
  }
  
  .mobile-submenu-link:hover {
    color: hsl(var(--background));
  }
  
  .mobile-menu-account {
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid hsla(var(--background) / 0.2);
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  
  .mobile-menu-account-link {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 0.875rem;
    color: hsla(var(--background) / 0.7);
    text-decoration: none;
  }
  
  .mobile-menu-account-link:hover {
    color: hsl(var(--background));
  }
  
  .mobile-menu-social {
    margin-top: auto;
    padding-top: 2rem;
    display: flex;
    gap: 1.5rem;
  }
  
  .mobile-menu-social a {
    color: hsla(var(--background) / 0.7);
    transition: color 0.2s ease;
  }
  
  .mobile-menu-social a:hover {
    color: hsl(var(--background));
  }
  
  @media (min-width: 1024px) {
    .mobile-menu {
      display: none;
    }
  }
</style>

<script>
  (function() {
    const mobileMenu = document.querySelector('[data-mobile-menu]');
    const closeBtn = document.querySelector('[data-mobile-menu-close]');
    const openBtn = document.querySelector('[data-action="open-mobile-menu"]');
    const submenuToggles = document.querySelectorAll('[data-submenu-toggle]');
    
    if (!mobileMenu) return;
    
    function openMenu() {
      mobileMenu.classList.add('is-active');
      mobileMenu.setAttribute('aria-hidden', 'false');
      document.body.style.overflow = 'hidden';
    }
    
    function closeMenu() {
      mobileMenu.classList.remove('is-active');
      mobileMenu.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';
    }
    
    if (openBtn) {
      openBtn.addEventListener('click', openMenu);
    }
    
    if (closeBtn) {
      closeBtn.addEventListener('click', closeMenu);
    }
    
    submenuToggles.forEach(toggle => {
      toggle.addEventListener('click', () => {
        const parent = toggle.closest('.mobile-menu-item');
        const isOpen = parent.classList.contains('is-open');
        
        // Close all other submenus
        document.querySelectorAll('.mobile-menu-item.is-open').forEach(item => {
          if (item !== parent) {
            item.classList.remove('is-open');
            item.querySelector('[data-submenu-toggle]')?.setAttribute('aria-expanded', 'false');
          }
        });
        
        // Toggle current submenu
        parent.classList.toggle('is-open', !isOpen);
        toggle.setAttribute('aria-expanded', !isOpen);
      });
    });
    
    // Close on escape
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && mobileMenu.classList.contains('is-active')) {
        closeMenu();
      }
    });
  })();
</script>
